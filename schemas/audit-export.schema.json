{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ai-hpp.org/schemas/audit-export.schema.json",
  "title": "Evidence Export Package",
  "type": "object",
  "required": [
    "export_id",
    "rir_profile",
    "generated_at",
    "records",
    "redaction_policy",
    "integrity"
  ],
  "properties": {
    "export_id": {
      "type": "string",
      "description": "Export id."
    },
    "rir_profile": {
      "type": "string",
      "description": "Rir profile."
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Generated at."
    },
    "records": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "raw_artifact_hash": {
            "type": "string",
            "description": "raw artifact hash field."
          },
          "summary_artifact_hash": {
            "type": "string",
            "description": "summary artifact hash field."
          },
          "source_system_id": {
            "type": "string",
            "description": "source system id field."
          },
          "cross_check_result": {
            "type": "string",
            "description": "cross check result field."
          },
          "kpi_metric": {
            "type": "number",
            "description": "kpi metric field."
          },
          "safety_threshold_version": {
            "type": "string",
            "description": "safety threshold version field."
          },
          "escalation_rate_window": {
            "type": "number",
            "description": "escalation rate window field."
          },
          "policy_override_count": {
            "type": "integer",
            "minimum": 0,
            "description": "policy override count field."
          },
          "tool_name": {
            "type": "string",
            "description": "tool name field."
          },
          "requested_capability": {
            "type": "string",
            "description": "requested capability field."
          },
          "manifest_reference_id": {
            "type": "string",
            "description": "manifest reference id field."
          },
          "allow_deny_decision": {
            "type": "string",
            "enum": [
              "allow",
              "deny"
            ],
            "description": "allow deny decision field."
          },
          "risk_domain": {
            "type": "string",
            "description": "risk domain field."
          },
          "override_threshold_ms": {
            "type": "integer",
            "minimum": 0,
            "description": "Maximum allowed override latency in milliseconds."
          },
          "actual_override_latency_ms": {
            "type": "integer",
            "minimum": 0,
            "description": "Observed override latency in milliseconds."
          },
          "degradation_trigger_flag": {
            "type": "boolean",
            "description": "degradation trigger flag field."
          },
          "raw_event_id": {
            "type": "string",
            "description": "raw event id field."
          },
          "summary_event_id": {
            "type": "string",
            "description": "summary event id field."
          },
          "severity_delta_score": {
            "type": "number",
            "description": "severity delta score field."
          },
          "reviewer_disposition": {
            "type": "string",
            "description": "reviewer disposition field."
          },
          "auth_token_id": {
            "type": "string",
            "description": "auth token id field."
          },
          "requested_resource": {
            "type": "string",
            "description": "requested resource field."
          },
          "granted_scope": {
            "type": "string",
            "description": "granted scope field."
          },
          "scope_mismatch_flag": {
            "type": "boolean",
            "description": "scope mismatch flag field."
          },
          "query_hash": {
            "type": "string",
            "description": "query hash field."
          },
          "intent_score": {
            "type": "number",
            "description": "intent score field."
          },
          "refusal_flag": {
            "type": "boolean",
            "description": "refusal flag field."
          },
          "intervention_mode": {
            "type": "string",
            "description": "intervention mode field."
          },
          "signal_score": {
            "type": "number",
            "description": "signal score field."
          },
          "escalation_threshold": {
            "type": "number",
            "description": "escalation threshold field."
          },
          "escalation_decision": {
            "type": "string",
            "description": "escalation decision field."
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "timestamp field."
          },
          "domain_risk_class": {
            "type": "string",
            "description": "CES domain risk class (e.g., R1-R4)."
          },
          "domain_confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Confidence score for domain classification."
          },
          "domain_signals": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Short domain detection signals."
          },
          "gate_triggered": {
            "type": "boolean",
            "description": "Whether a CES gate was triggered."
          },
          "gate_type": {
            "type": "string",
            "description": "CES gate type identifier."
          },
          "approval_required": {
            "type": "boolean",
            "description": "Whether human approval is required."
          },
          "required_approver_role": {
            "type": "string",
            "description": "Governance role required for approval."
          },
          "approval_status": {
            "type": "string",
            "enum": [
              "requested",
              "approved",
              "rejected",
              "timeout"
            ],
            "description": "Approval state for gated actions."
          },
          "escalation_event": {
            "type": [
              "object",
              "array"
            ],
            "description": "Minimal escalation metadata."
          },
          "chosen_action": {
            "type": "string",
            "description": "Action selected after gating logic."
          },
          "top_k_alternatives_agg": {
            "type": "array",
            "minItems": 3,
            "maxItems": 5,
            "items": {
              "type": "object",
              "required": [
                "category",
                "reason_short"
              ],
              "properties": {
                "category": {
                  "type": "string"
                },
                "reason_short": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "description": "Aggregated top-K alternatives without chain-of-thought."
          },
          "constraints_triggered": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Constraints triggered by CES evaluation."
          },
          "safe_hold_invoked": {
            "type": "boolean",
            "description": "Whether safe-hold was invoked."
          },
          "uncertainty_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Uncertainty score at decision time."
          },
          "time_pressure_signal": {
            "type": "boolean",
            "description": "Whether time-pressure signal was active."
          },
          "evidence_refs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Evidence references supporting CES decision."
          },
          "escalation_timeout_triggered": {
            "type": "boolean",
            "description": "Whether escalation timeout fired before human response."
          },
          "safe_state_entered": {
            "type": "boolean",
            "description": "Whether configured safe state was entered on escalation timeout."
          },
          "escalation_timeout_ms": {
            "type": "integer",
            "minimum": 0,
            "description": "Configured escalation timeout in milliseconds for the evaluated event."
          },
          "override_actor_role": {
            "type": "string",
            "description": "Role of the human actor who applied override."
          },
          "override_reason_code": {
            "type": "string",
            "description": "Controlled reason code for human override."
          },
          "override_latency_ms": {
            "type": "integer",
            "minimum": 0,
            "description": "Measured time to apply human override in milliseconds."
          },
          "override_frequency_counter": {
            "type": "integer",
            "minimum": 0,
            "description": "Counter of override occurrences within implementation-defined review window."
          }
        },
        "additionalProperties": false,
        "description": "Evidence export record items."
      },
      "description": "Records."
    },
    "redaction_policy": {
      "type": "object",
      "required": [
        "policy_id",
        "rules"
      ],
      "properties": {
        "policy_id": {
          "type": "string",
          "description": "Policy id."
        },
        "rules": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Items."
          },
          "description": "Rules."
        }
      },
      "additionalProperties": false,
      "description": "Redaction policy."
    },
    "integrity": {
      "type": "object",
      "required": [
        "hash_algorithm",
        "hash_value",
        "signature"
      ],
      "properties": {
        "hash_algorithm": {
          "type": "string",
          "enum": [
            "sha256"
          ],
          "description": "Hash algorithm."
        },
        "hash_value": {
          "type": "string",
          "description": "Hash value."
        },
        "signature": {
          "type": "string",
          "description": "Signature placeholder"
        }
      },
      "additionalProperties": false,
      "description": "Integrity."
    }
  },
  "additionalProperties": false,
  "description": "Evidence Export Package for AI-HPP artifacts."
}
